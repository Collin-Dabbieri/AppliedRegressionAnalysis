---
title: "Assignment 3"
author: "Collin Dabbieri"
date: "10/17/2019"
output: 
  html_document:
    toc: yes
    toc_float: yes
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Number of Questions Completed: 6/6

# 1 Q 12.40

## a)

Suppose you want to use repellant type to model the cost per use (y). Create the appropriate number of dummy variables for repellant type and write the model.

There's only two levels (Lotion/Cream and Aerosol/Spray) so we only need 1 dummy variable

$x_1=0$ if lotion/cream
$x_1=1$ if aerosol/spray

$E(y)=\beta_0+\beta_1x_1$

## b) 

Fit the model to the data

```{r}
x1=c(0,1,0,0,0,1,1,1,1,1,1,0,0,1)
y=c(2.08,0.67,1.00,0.75,0.46,0.11,0.22,0.19,0.24,0.27,1.77,0.67,0.36,2.75)

model=lm(y~x1)
summary(model)
```


## c) 

Give the NULL hypothesis for testing whether repellant type is a useful predictor of cost per use (y)

$$H_0:\beta_1=0$$

## d) 

Conduct the test, part c, and give the appropriate conclusion. Use $\alpha=0.1$.

```{r}
summary(model)
```


The p-value from the F test is significantly greater than 0.1. We can not reject the NULL meaning we can not say with confidence that repellant type is a useful predictor of cost per use.

## e)

Repeat parts a-d if the dependent variable is maximum number of hours of protection (y)

$x_1$ is the same as in part a)

```{r}
x1=c(0,1,0,0,0,1,1,1,1,1,1,0,0,1)
y=c(13.5,0.5,2.0,7.0,3.0,6.0,3.0,5.5,6.5,1.0,14.0,3.0,7.0,24.0)
model=lm(y~x1)
```

The NULL hypothesis for testing whether repellant type is a useful predictor of maximum number of hours of protection is

$$H_0:\beta_1=0$$
```{r}
summary(model)
```

Again our p-value for the F test is significantly greater than 0.1 meaning we cannot reject the NULL. We cannot say with confidence that repellant type is a useful predictor of maximum number of hours of protection.

# 2 Q 12.42

Wastewater treatment plants emit greenhouse gases like methane. Methane emissions were surveyed for sludge with and without nutrients added. The length of time (in days) the sludge was processed is also given. Use regression to determine if the mean amount of methane gas emitted differs for the two types of sludge, and if so, provide a 95% confidence interval for the magnitude of the difference.

Seeing as how the next problem has us incorporate the time data, I assume we're supposed to ignore it here. You would never do this in a real analysis because the amount of greenhouse gas emitted would be strongly dependent on the amount of time passed during processing.

We have two levels for our categorical data, so we only need 1 dummy variable. $x_1=0$ if no nutrients added and $x_1=1$ if nutrients added.

```{r}
methane=c(5,9,18,35,61,65,105,120,117,154,200,198,203,21,25,61,75,102,150,183,194,245,308,295,272,280,287)
x1=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
model=lm(methane~x1)
summary(model)
```

The NULL hypothesis for our F statistic is 

$$H_0:\beta_1=0$$

We can see the p-value for our F-test is significantly less than 0.05 so we can say, with 95% confidence, that the mean amount of methane gas differs for the two types of sludge. The data suggests that sludge with nutrients emits more greenhouse gases.

$\beta_1=\mu_1-\mu_0$ so a 95% confidence interval for $\beta_1$ gives us an interval estimate for the difference in the mean amount of methane gas emitted over time for the two types of sludge.

```{r}
library(s20x)

ciReg(model)
```


So a 95% confidence interval for the difference in the amount of methane gas emitted over time for sludge with nutrients and sludge without nutrients is (6.454,151.941).


# 3 Q 12.51

Now include time data. Use regression to determine if the emission rates differ for the two types of sludge, and if so, provide an estimate of each emission rate.

What we care about here is the slope, for the slopes to differ we'll need to include an interaction term.

$$E(y)=\beta_0+\beta_1t+\beta_2x_1+\beta_3tx_1$$


```{r}
methane=c(5,9,18,35,61,65,105,120,117,154,200,198,203,21,25,61,75,102,150,183,194,245,308,295,272,280,287)
time=c(20,21,24,26,29,32,35,37,42,44,47,49,51,20,21,24,26,29,32,34,36,37,42,44,47,49,51)
x1=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1)

model=lm(methane~time+x1+time:x1)
summary(model)
```

Let's plot the response curves to get an idea of the effect of nutrients on the slope

$$E(y)_{nutrients}=(\beta_0+\beta_2)+(\beta_1+\beta_3)t$$

$$E(y)_{no\:nutirents}=\beta_0+\beta_1t$$

```{r}
B0=model$coefficients[1]
B1=model$coefficients[2]
B2=model$coefficients[3]
B3=model$coefficients[4]

t=seq(min(time),max(time),length.out=100)

y_nut=(B0+B2)+(B1+B3)*t
y_nonut=B0+B1*t

plot(t,y_nut,type='l',col='red',ylab="Methane Emissions",xlab="Time (Days)")
lines(t,y_nonut,type='p',col='blue')

legend(25,250,legend=c("nutrients","no nutrients"),col=c("red","blue"),lty=c(1,3))
```

The NULL hypothesis for the slopes to be the same is 

$$H_0:\beta_3=0$$

The p-value from our T-statistic is less than 0.05. So we can say with 95% confidence that the emission rates are different.

A point estimate for the emission rates is given by $\hat{\beta_1}+\hat{\beta_3}$ for nutrients added and $\hat{\beta_1}$ for no nutrients added.

For nutrients added, an estimate for the emission rate is `r B1+B3`.

For no nutrients added, an estimate for the emission rate is `r B1`.

# 4 Q 12.59

An exploration seismologist wants to develop a regression model for estimating the mean signal-to-noise ratio of seismic waves from earthquakes. The model under consideration is a complete second-order model

$$E(y)=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_1x_2+\beta_4x_1^2+\beta_5x_2^2$$

Where y=Signal-to-noise ratio, x1=Frequency of wavelet, and x2=Amplitude of wavelet. Both the complete model and the reduced model, $E(y)=\beta_0+\beta_1x_1+\beta_2x_2$ were fit to n=12 data points, with the following results: $SSE_c=159.94$, $MSE_c=26.66$, $SSE_r=2094.4$, $MSE_r=232.7$. Compare the two models using a nested model F test at $\alpha=0.05$. What do you conclude?

The F statistic is given by

$$F=\frac{\frac{SSE_r-SSE_c}{Difference\:in\:number\:of\:\beta 's\:tested}}{MSE_c}$$

Which we'll compare against the F distribution with $\nu_1=3,\nu_2=12$

```{r}
F_val=((2094.4-159.94)/3)/(26.66)
F_reject=qf(0.95,3,12)

F_val
F_reject
```


We can see that we are in the rejection region. We can reject the NULL

$$H_0:\beta_3=\beta_4=\beta_5=0$$

Meaning we can conclude that the interaction and quadratic terms contribute information to the prediction of mean signal-to-noise ratio of seismic waves from earthquakes.

# 5 Q 12.79

y=natural logarithm of supply price

$x_1$=Distance shipped (hundreds of miles)

$x_2$=Weight of the product shipped (thousands of pounds)

$x_3$=1 if deregulation in effect, 0 if not

$x_4$=1 if trip originates in Miami, 0 if in Jacksonville

$$\hat{y}=12.192-0.598x_1-0.00598x_2-0.01078x_1x_2+0.086x_1^2+0.00014x_2^2+0.677x_4-0.275x_1x_4-0.026x_2x_4+0.013x_1x_2x_4-0.782x_3+0.0399x_1x_3-0.021x_2x_3-0.0033x_1x_2x_3$$

## a)

Based on the equation, give an estimate of the difference between the predicted regulated price and predicted deregulated price for any fixed value of mileage, weight, and origin.

Let's set origin to Jacksonville so the $x_4$ terms drop out.

Regulated has $x_3$=0 so regulated prices will have $x_3$ terms drop out

$$E(y)_{regulated}=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_1x_2+\beta_4x_1^2+\beta_5x_2^2$$

Deregulated has $x_3=1$

$$E(y)_{deregulated}=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_1x_2+\beta_4x_1^2+\beta_5x_2^2+\beta_{10}+\beta_{11}x_1+\beta_{12}x_2+\beta_{13}x_1x_2$$

Setting $x_1=20$, $x_2=4$

```{r}
x1=0.5
x2=4
Ey_reg=12.192-0.598*x1-0.00598*x2-0.01078*x1*x2+0.086*x1^2+0.00014*x2^2

Ey_dereg=12.192-0.598*x1-0.00598*x2-0.01078*x1*x2+0.086*x1^2+0.00014*x2^2-0.782+0.0399*x1-0.021*x2-0.0033*x1*x2

exp(Ey_reg)

exp(Ey_dereg)
```


## b)

Demonstrate the impact of deregulation on price charged using the estimated $\beta$'s, but now hold distance fixed at 100 miles, origin fixed at Miami, and weight fixed at 10,000 pounds

```{r}
x1=1
x2=10

Ey_reg=12.192-0.598*x1-0.00598*x2-0.01078*x1*x2+0.086*x1^2+0.00014*x2^2+0.677-0.275*x1-0.026*x2+0.013*x1*x2

Ey_dereg=12.192-0.598*x1-0.00598*x2-0.01078*x1*x2+0.086*x1^2+0.00014*x2^2+0.677-0.275*x1-0.026*x2+0.013*x1*x2-0.782+0.0399*x1-0.021*x2-0.0033*x1*x2

exp(Ey_reg)
exp(Ey_dereg)
```

## c)

The data file TRUCKING contains data on trucking prices for four Florida carriers (A,B,C, and D). These carriers are identified by the variable CARRIER. Using the above model as a base model, add terms that allow for different response curves for the four carriers. Conduct the appropriate test to determine if the curves differ.

```{r}
library(readxl)

trucking=read_excel("../../Dataxls/Excel/TRUCKING.XLS")
head(trucking)
```
Our categorical data has 4 levels so we'll need 3 dummy variables

y=ln(price)
x1=mileage (hundreds of miles)
x2=weight (thousands of pounds)
if A: x3=0, x4=0, x5=0
if B: x3=0, x4=0, x5=1
if C: x3=0, x4=1, x5=0
if D: x3=1, x4=0, x5=0



```{r}
y=log(trucking[,1])
x1=trucking[,2]
x2=trucking[,3]
x12=x1^2
x22=x2^2

x3=c()
x4=c()
x5=c()

for(i in 1:dim(trucking)[1]){
  if(toString(trucking[i,8])=="A"){
    x3=append(x3,0)
    x4=append(x4,0)
    x5=append(x5,0)
  }
  if(toString(trucking[i,8])=="B"){
    x3=append(x3,0)
    x4=append(x4,0)
    x5=append(x5,1)
  }
  if(toString(trucking[i,8])=="C"){
    x3=append(x3,0)
    x4=append(x4,1)
    x5=append(x5,0)
  }
  if(toString(trucking[i,8])=="D"){
    x3=append(x3,1)
    x4=append(x4,0)
    x5=append(x5,0)
  }
}

y=unlist(y)
x1=unlist(x1)
x12=unlist(x12)
x2=unlist(x2)
x22=unlist(x22)
x3=unlist(x3)
x4=unlist(x4)
x5=unlist(x5)

```



```{r}
model=lm(y~x1+x2+x1:x2+x12+x22+x3+x1:x3+x2:x3+x1:x2:x3+x4+x1:x4+x2:x4+x1:x2:x4+x5+x1:x5+x2:x5+x1:x2:x5)
summary(model)
```


We want to know if the response curves differ. If Carrier is A our response curve is given by

$$E(y)=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_1^2+\beta_4x_2^2+\beta_8x_1x_2$$

However, if Carrier is B our response curve is 

$$E(y)=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_1^2+\beta_4x_2^2+\beta_7x_5+\beta_8x_1x_2+\beta_{13}x_1x_5+\beta_{14}x_2x_5+\beta_{17}x_1x_2x_5$$

$$E(y)=(\beta_0+\beta_7)+(\beta_1+\beta_{13})x_1+(\beta_2+\beta_{14})x_2+\beta_3x_1^2+\beta_4x_2^2+(\beta_8+\beta_{17})x_1x_2$$

So to see if this response curve is different than our baseline, we need to test the NULL

$$H_0:\beta_7=\beta_{13}=\beta_{14}=\beta_{17}=0$$


We could accomplish this with a nested model that does not include the $\beta_7,\beta_{13},\beta_{14},\beta_{17}$ terms.

Here our F statistic 
$$F=\frac{\frac{SSE_r-SSE_c}{Difference\:in\:number\:of\:\beta 's\:tested}}{MSE_c}$$
again proves useful.

I'll also generate reduced models for the other CARRIER values.

```{r}
# Ok this function takes two quantitative variables and our three dummy variables, as well as the price
# It also takes which CARRIER value we want to test for
# It will return an F statistic generated by using a reduced model that does not include the terms utilized by that CARRIER value
#choice = B","C" or "D"
myF=function(y,x1,x2,x3,x4,x5,choice){
  x12=x1^2
  x22=x2^2
  
  modelc=lm(y~x1+x2+x1:x2+x12+x22+x3+x1:x3+x2:x3+x1:x2:x3+x4+x1:x4+x2:x4+x1:x2:x4+x5+x1:x5+x2:x5+x1:x2:x5)
  
  if(choice=="B"){
    #x5 is important, so it is removed
    modelr=lm(y~x1+x2+x1:x2+x12+x22+x3+x1:x3+x2:x3+x1:x2:x3+x4+x1:x4+x1:x2:x4)
  }
  if(choice=="C"){
    #x4 is important, so it is removed
    modelr=lm(y~x1+x2+x1:x2+x12+x22+x3+x1:x3+x2:x3+x1:x2:x3+x5+x1:x5+x1:x2:x5)
  }
  if(choice=="D"){
    #x3 is important, so it is removed
    modelr=lm(y~x1+x2+x1:x2+x12+x22+x4+x1:x4+x2:x4+x1:x2:x4+x5+x1:x5+x1:x2:x5)
  }
  
  diffbeta=length(modelc$coefficients)-length(modelr$coefficients)
  
  resc=modelc$residuals
  resc2=resc^2
  resr=modelr$residuals
  resr2=resr^2
  SSEr=sum(resr2)
  SSEc=sum(resc2)
  MSEc=mean(resc2)
  
  F_val=((SSEr-SSEc)/diffbeta)/(MSEc)
  
  return(list(F_statistic=F_val))
  
  
}
```

Let's determine the F value for the rejection region
```{r}
k=length(model$coefficients)
qf(0.95,4,dim(trucking)[1]-(k+1))

```

Now for the F values for each CARRIER (remember these are testing for a difference in the responsive curve with respect to the baseline, CARRIER A)
```{r}
myF(y,x1,x2,x3,x4,x5,"B")
myF(y,x1,x2,x3,x4,x5,"C")
myF(y,x1,x2,x3,x4,x5,"D")
```


So only CARRIER B is in the rejection region. For CARRIER B, we can reject the NULL $H_0:\beta_7=\beta_{13}=\beta_{14}=\beta_{17}=0$ and say with 95% confidence that the response curve for B differs from our baseline, CARRIER A.

I also just realized that the NULL

$$H_0:\beta_7=\beta_{13}=\beta_{14}=\beta_{17}=0$$

could be much more easily tested with the T-statistic given in the summary output

```{r}
model=lm(y~x1+x2+x1:x2+x12+x22+x3+x1:x3+x2:x3+x1:x2:x3+x4+x1:x4+x2:x4+x1:x2:x4+x5+x1:x5+x2:x5+x1:x2:x5)
summary(model)
```
We can see that the $x_5$ term, corresponding to CARRIER B, is the only one with a p-value for the T-statistic less than 0.05. So only for CARRIER B can we say with confidence that the response curve is different than our baseline.

# 6 Q 12.80

do in R as well as look at SAS output

y= Mass burning rate

$x_1$=Brake power

$x_2$=1 if DF-2 fuel, 0 if not

$x_3$=1 if blended fuel, 0 if not

$$E(y)=\beta_0+\beta_1x_1+\beta_2x_2+\beta_3x_3+\beta_4x_1x_2+\beta_5x_1x_3$$

## a) 

Conduct a test to determine whether brake power and fuel type interact. Test using $\alpha=0.01$.

Our NULL is 

$$H_0:\beta_4=\beta_5=0$$

```{r}
y=c(13.2,17.5,17.5,26.1,32.7,43.5,25.9,46.3,45.6,30.7,50.8,68.9,32.3,57.1)
x1=c(4,4,4,6,6,6,8,8,8,10,10,10,12,12)
x2=c(1,0,0,1,0,0,1,0,0,1,0,0,1,0)
x3=c(0,1,0,0,1,0,0,1,0,0,1,0,0,1)

model=lm(y~x1+x2+x3+x1:x2+x1:x3)
summary(model)

beta0=model$coefficients[1]
beta1=model$coefficients[2]
beta2=model$coefficients[3]
beta3=model$coefficients[4]
beta4=model$coefficients[5]
beta5=model$coefficients[6]

```

The p-value for the T-statistic for the $x_1x_2$ term is less than 0.01. We can say with 99% confidence that brake power and fuel type interact.

## b) 

Refer to the model, part a. Give the estimates of the slope of the y-$x_1$ line for each of the three fuel types.

For Advanced Timing (our baseline)

$$E(y)=\beta_0+\beta_1x_1$$

The slope is given by $\beta_1$=`r beta1`

For DF-2 Fuel ($x_2$=1)

$$E(y)=\beta_0+\beta_1x_1+\beta_2+\beta_4x_1$$

$$E(y)=(\beta_0+\beta_2)+(\beta_1+\beta_4)x_1$$

The slope is given by $\beta_1+\beta_4$=`r beta1+beta4`

Finally, for blended fuel ($x_3$=1)

$$E(y)=\beta_0+\beta_1x_1+\beta_3+\beta_5x_1$$

$$E(y)=(\beta_0+\beta_3)+(\beta_1+\beta_5)x_1$$

The slope is given by $\beta_1+\beta_5$=`r beta1+beta5`









